{
  "version": "1.1",
  "schema_date": "2025-10-31",
  "description": "Stability KPI definitions aligned with STAB-001 SLOs and observability plan",
  "kpis": {
    "crash_rate": {
      "name": "Crash Rate",
      "unit": "crashes per 1,000,000 sessions",
      "threshold": 1.0,
      "slo": ">99.9% crash-free sessions",
      "collection": "asynchronous telemetry from production deployments",
      "calculation": "(total_crashes / total_sessions) * 1e6",
      "alert_level": "critical",
      "definition": "User-facing application crash reported to telemetry backend. Excludes developer debug asserts and customer code crashes.",
      "links": ["ADR-001", "STAB-001"],
      "owner": "Observability Lead"
    },
    "device_lost_frequency": {
      "name": "Device Lost Events",
      "unit": "events per runtime hour",
      "threshold": 0.5,
      "slo": "<0.5 per hour per platform",
      "collection": "driver instrumentation + synthetic chaos tests",
      "calculation": "total_device_lost_events / total_runtime_hours",
      "alert_level": "warning",
      "definition": "GPU device reset or critical error requiring recovery. Synthetic tests inject loss to validate <500ms recovery.",
      "links": ["ADR-001", "STAB-019"],
      "owner": "Render Tech Lead"
    },
    "frame_stall_spikes": {
      "name": "Frame Time Spikes",
      "unit": "milliseconds over budget per hour",
      "threshold": 100,
      "slo": "<100ms cumulative over budget per hour",
      "collection": "per-frame timer aggregated hourly",
      "calculation": "sum(max(frame_time_ms - budget_ms, 0))",
      "alert_level": "warning",
      "definition": "Cumulative frame time overages vs. 16.67ms budget (60Hz). Frames above 50ms counted as spikes.",
      "links": ["STAB-004", "STAB-008"],
      "owner": "Performance Engineer"
    },
    "nondeterminism_rate": {
      "name": "Nondeterminism Divergences",
      "unit": "divergences per 1,000,000 frames",
      "threshold": 0,
      "slo": "Zero divergences in determinism mode",
      "collection": "record/replay suites with per-frame hash comparison",
      "calculation": "(frames_with_hash_differences / total_frames) * 1e6",
      "alert_level": "critical",
      "definition": "Unexpected divergence detected during deterministic runs (physics, culling, animation, GPU dispatch order).",
      "links": ["ADR-001", "STAB-005", "STAB-006"],
      "owner": "Engine Runtime Lead"
    },
    "nan_inf_incidents": {
      "name": "NaN / Inf Incidents",
      "unit": "incidents per 1,000,000 operations",
      "threshold": 5,
      "slo": "â‰¤5 per million operations",
      "collection": "instrumented math libraries with sanitizers",
      "calculation": "(nan_inf_hits / total_operations) * 1e6",
      "alert_level": "warning",
      "definition": "Occurrences of NaN or Infinity in math/physics subsystems (captured before propagation).",
      "links": ["STAB-014", "STAB-016"],
      "owner": "Math/Time Lead"
    },
    "asset_import_failures": {
      "name": "Asset Import Failures",
      "unit": "failures per 1,000 imports",
      "threshold": 2,
      "slo": "<0.2% deterministic failure rate",
      "collection": "asset pipeline telemetry",
      "calculation": "(failed_imports / total_imports) * 1e3",
      "alert_level": "warning",
      "definition": "Deterministic import failures excluding malformed source content.",
      "links": ["STAB-013", "STAB-025"],
      "owner": "Content Pipeline Lead"
    },
    "memory_fragmentation": {
      "name": "GPU Memory Fragmentation",
      "unit": "percentage",
      "threshold": 20,
      "slo": "<20% fragmentation under nominal load",
      "collection": "allocator diagnostics during frame graph capture",
      "calculation": "(1 - largest_free_block / total_free_memory) * 100",
      "alert_level": "warning",
      "definition": "GPU heap fragmentation reported by allocator metrics.",
      "links": ["STAB-021"],
      "owner": "Render Tech Lead"
    },
    "handle_leak_rate": {
      "name": "GPU Handle Leaks",
      "unit": "leaked handles per 1,000 frames",
      "threshold": 0,
      "slo": "0 over 24h soak",
      "collection": "device-lost chaos test, resource tracking",
      "calculation": "(leaked_handles / total_frames) * 1000",
      "alert_level": "critical",
      "definition": "GPU handles (buffers, textures, sampler states) not freed after device-lost recovery or normal shutdown.",
      "links": ["STAB-019"],
      "owner": "Render Tech Lead"
    },
    "perf_regression": {
      "name": "Frame Time Regression",
      "unit": "percent slower vs. baseline",
      "threshold": 5.0,
      "slo": "<5% regression per build",
      "collection": "CI perf gates, benchmark suite",
      "calculation": "((current_frame_time - baseline_frame_time) / baseline_frame_time) * 100",
      "alert_level": "warning",
      "definition": "Any commit that increases median frame time by >5% compared to previous stable build. Measured in determinism mode on fixed scene.",
      "links": ["STAB-004"],
      "owner": "Performance Engineer"
    },
    "golden_image_regression": {
      "name": "Golden Image Regression",
      "unit": "SSIM score (0-1)",
      "threshold": 0.95,
      "slo": ">0.95 across all platforms",
      "collection": "golden image test suite, per-platform CI jobs",
      "calculation": "structural_similarity(rendered, baseline) with perceptual weighting",
      "alert_level": "warning",
      "definition": "Visual regression detected by SSIM comparison between rendered image and golden baseline. Per-GPU vendor (NVIDIA, AMD, Intel), per-driver version.",
      "links": ["STAB-033"],
      "owner": "Graphics QA Lead"
    }
  },
  "platforms": [
    "Windows",
    "Linux",
    "macOS",
    "Console (TBD)"
  ],
  "reporting_cadence": {
    "real_time": ["crash_rate", "nan_inf_incidents", "handle_leak_rate", "nondeterminism_rate"],
    "hourly": ["frame_stall_spikes", "perf_regression"],
    "daily": ["device_lost_frequency", "asset_import_failures"],
    "weekly": ["memory_fragmentation", "golden_image_regression"]
  },
  "alert_escalation": {
    "critical": {
      "escalate_after": "5 minutes",
      "recipients": ["on-call-eng", "stability-lead"],
      "action": "block-release, file-issue"
    },
    "warning": {
      "escalate_after": "1 hour",
      "recipients": ["stability-team"],
      "action": "investigate, update-dashboard"
    }
  }
}