version: 1
name: Stability Roadmap Backlog
owner_team: engine-platform
notes: >-
  Backlog derived from the stability implementation guide. Tickets are sized for
  initial implementation and migration. Use labels: [stability, infra, render, physics,
  assets, testing, ci, observability, governance, security, perf]. Estimates are in ideal days.

epics:
  - key: EPIC-01
    title: Stability targets and SLOs
    goal: Define measurable stability targets and platform-wide guarantees.
  - key: EPIC-02
    title: Baseline and metrics
    goal: Establish subsystem inventory, KPIs, and budgets with telemetry.
  - key: EPIC-03
    title: Architecture foundations
    goal: ECS/job system, frame graph, fixed-step loop, deterministic toggle, floating-origin.
  - key: EPIC-04
    title: Technology selections
    goal: Select mature libraries/tooling across assets, rendering, shaders, physics, math.
  - key: EPIC-05
    title: Numerical stability rules
    goal: Codify math/time/transform/camera/animation rules and implement guards.
  - key: EPIC-06
    title: Rendering robustness
    goal: Device-loss recovery, PSO/state, allocators, TAA stability, visibility.
  - key: EPIC-07
    title: Asset pipeline hardening
    goal: Deterministic import/bake, caching, sandboxing, hot-reload safety.
  - key: EPIC-08
    title: Physics stability
    goal: Deterministic fixed-substep physics with stable configs.
  - key: EPIC-09
    title: Testing & verification
    goal: Golden images, determinism, fuzzing, sanitizers, soak tests.
  - key: EPIC-10
    title: Observability & ops
    goal: Structured logs, timing, crash dumps, repro recipes.
  - key: EPIC-11
    title: Migration strategy
    goal: Strangler-phase migration with dual-runs and feature flags.
  - key: EPIC-12
    title: Governance & versioning
    goal: Semver, compatibility tests, SBOM, pinned toolchains.
  - key: EPIC-13
    title: Performance budgets
    goal: Budgets as guardrails with CI gates and dashboards.
  - key: EPIC-14
    title: Security & safety
    goal: Sandbox parsers, signed shaders, hardened serialization.
  - key: EPIC-15
    title: Acceptance gates
    goal: CI acceptance checks for stability sign-off.

backlog:
  - id: STAB-001
    epic: EPIC-01
    title: Define crash-free SLOs and stability targets
    description: >-
      Document crash-free session/frame SLOs (>99.9%), reproducible frames target,
      deterministic simulation mode, device-loss recovery requirement, API/ABI stability
      windows, and reproducible builds policy.
    acceptance_criteria:
      - ADR published with numeric SLOs and scope (platforms, tiers)
      - Policy for determinism mode and when required
      - API/ABI stability window defined with versioning rules
      - Reproducible build expectations documented
    dependencies: []
    estimate: 2d
    priority: P1
    labels: [stability, governance]

  - id: STAB-002
    epic: EPIC-02
    title: Subsystem inventory and ownership map
    description: Catalog math, time, transforms, animation, rendering, physics, IO, tooling; assign owners.
    acceptance_criteria:
      - Inventory doc with subsystem boundaries and repos
      - OWNER per subsystem recorded
    dependencies: []
    estimate: 1d
    priority: P1
    labels: [infra]

  - id: STAB-003
    epic: EPIC-02
    title: Define stability KPIs and schema
    description: Define KPIs (crash rate, device-lost freq, frame stalls, NaN/Inf, nondeterminism, asset import failures, fragmentation).
    acceptance_criteria:
      - KPI schema in metrics spec (JSON)
      - Thresholds or SLO links per KPI
    dependencies: [STAB-001]
    estimate: 1d
    priority: P1
    labels: [observability]

  - id: STAB-004
    epic: EPIC-02
    title: Establish performance budgets
    description: Budgets for frame ms, VRAM/DRAM, job counts, draw/dispatch limits per platform.
    acceptance_criteria:
      - Budget table per platform committed
      - CI config placeholders for perf gates
    dependencies: [STAB-002]
    estimate: 2d
    priority: P1
    labels: [perf]

  - id: STAB-005
    epic: EPIC-03
    title: Fixed-step simulation loop with interpolation
    description: Implement accumulator loop with clamped dt, interpolation to render ticks.
    acceptance_criteria:
      - Toggle to enable fixed-step mode
      - Unit tests for accumulator clamping and catch-up cap
      - Render decoupled from sim with interpolation verified
    dependencies: []
    estimate: 3d
    priority: P1
    labels: [engine]

  - id: STAB-006
    epic: EPIC-03
    title: Determinism mode toggle and seed plumbing
    description: Global deterministic mode that freezes nondeterminism sources and seeds RNGs.
    acceptance_criteria:
      - Global flag plumbed to subsystems
      - Deterministic RNG utility with fixed seeds for tests
      - Build tag or runtime switch documented
    dependencies: [STAB-005]
    estimate: 2d
    priority: P1
    labels: [engine, testing]

  - id: STAB-007
    epic: EPIC-03
    title: Floating-origin system for large worlds
    description: Implement origin rebasing with thresholds; camera-relative rendering support.
    acceptance_criteria:
      - Origin shift with minimal popping; tests for precision improvement
      - Render and physics agree on origin offset
      - Serialization includes origin state
    dependencies: [STAB-005]
    estimate: 4d
    priority: P2
    labels: [engine, render, physics]

  - id: STAB-008
    epic: EPIC-03
    title: Frame graph integration (MVP)
    description: Introduce a render graph encoding pass dependencies and resource lifetimes.
    acceptance_criteria:
      - Graph can compile a simple scene (depth prepass + forward + UI)
      - Resource barriers validated; passes declare reads/writes
      - Per-frame transient allocations tracked by graph
    dependencies: []
    estimate: 5d
    priority: P1
    labels: [render]

  - id: STAB-009
    epic: EPIC-03
    title: Stable plugin boundary (C ABI + capability queries)
    description: Define versioned plugin ABI with capability negotiation and strict boundaries.
    acceptance_criteria:
      - C header defining ABI version and capability query
      - Sample plugin loads/unloads; mismatch handled gracefully
      - Compatibility test in CI
    dependencies: []
    estimate: 3d
    priority: P2
    labels: [infra]

  - id: STAB-010
    epic: EPIC-04
    title: Decide rendering stack
    description: Choose bgfx/Filament/WGPU or direct API; document trade-offs and selected path.
    acceptance_criteria:
      - Decision record with evaluation matrix
      - Spike running a triangle on target platforms
    dependencies: []
    estimate: 2d
    priority: P1
    labels: [render]

  - id: STAB-011
    epic: EPIC-04
    title: Shader toolchain setup
    description: DXC + SPIRV-Cross pipeline; offline compile; strict warnings; include graph freezing.
    acceptance_criteria:
      - CI step compiles shaders offline to target formats
      - Warnings-as-errors enforced
      - Include graph hash embedded for cache keys
    dependencies: [STAB-010]
    estimate: 3d
    priority: P1
    labels: [render, build]

  - id: STAB-012
    epic: EPIC-04
    title: Physics engine selection spike
    description: Evaluate PhysX 5 vs Jolt vs Bullet; decide and record.
    acceptance_criteria:
      - Decision doc with determinism and licensing considerations
      - Sample scene stable at fixed dt
    dependencies: []
    estimate: 2d
    priority: P1
    labels: [physics]

  - id: STAB-013
    epic: EPIC-04
    title: Asset formats decision and import libraries
    description: Authoring via USD; runtime glTF 2.0 + KTX2/Basis; choose OpenUSD SDK, tinygltf, OIIO.
    acceptance_criteria:
      - Decision record with import support matrix
      - Sample import of mesh + textures to runtime pack
    dependencies: []
    estimate: 2d
    priority: P1
    labels: [assets]

  - id: STAB-014
    epic: EPIC-05
    title: Epsilon policy and numeric config module
    description: Centralize tolerances; denormal flush-to-zero; SIMD math policy.
    acceptance_criteria:
      - Single header/module for epsilons by unit scale
      - FTZ/DAZ toggles validated in debug
      - Codebase references policy module only
    dependencies: []
    estimate: 2d
    priority: P2
    labels: [math]

  - id: STAB-015
    epic: EPIC-05
    title: Time accumulator utilities
    description: Library for clamped dt, jitter filtering, catch-up cap.
    acceptance_criteria:
      - Unit tests cover clamping and filter response
      - Integrated into main loop (see STAB-005)
    dependencies: [STAB-005]
    estimate: 1d
    priority: P1
    labels: [engine]

  - id: STAB-016
    epic: EPIC-05
    title: Transform hygiene utilities
    description: Normalize quats; orthonormalize matrices; stable look-at; parent-last eval.
    acceptance_criteria:
      - Property-based tests show bounded drift
      - NaN/Inf sanitizers around transform ops
    dependencies: []
    estimate: 2d
    priority: P2
    labels: [math]

  - id: STAB-017
    epic: EPIC-05
    title: Camera model upgrades
    description: Reversed-Z + infinite far; jitter with deterministic RNG; history reset rules.
    acceptance_criteria:
      - Depth precision verified; z-fighting reduced
      - TAA history resets on topology/scale changes
    dependencies: [STAB-008]
    estimate: 3d
    priority: P2
    labels: [render]

  - id: STAB-018
    epic: EPIC-05
    title: Summation stability utilities
    description: Kahan/Neumaier accumulators for long reductions.
    acceptance_criteria:
      - Benchmarks and correctness tests
      - Integrated into relevant systems (particles, metrics)
    dependencies: []
    estimate: 1d
    priority: P3
    labels: [math]

  - id: STAB-019
    epic: EPIC-06
    title: Device-lost handler and chaos test
    description: Idempotent teardown/recreate of device resources; forced reset test path.
    acceptance_criteria:
      - Automated test triggers device lost and recovers
      - No leaks/handles left after multiple cycles
    dependencies: [STAB-010, STAB-008]
    estimate: 4d
    priority: P1
    labels: [render, testing]

  - id: STAB-020
    epic: EPIC-06
    title: PSO/state management with hashing and immutable samplers
    description: Hashed pipeline cache; immutable sampler sets; explicit barriers validated by frame graph.
    acceptance_criteria:
      - Cache hits tracked; no dynamic sampler churn
      - Barriers auto-generated/validated
    dependencies: [STAB-008, STAB-011]
    estimate: 4d
    priority: P2
    labels: [render]

  - id: STAB-021
    epic: EPIC-06
    title: Resource allocators and defragmentation strategy
    description: Per-frame linear arenas; buddy/slab pools; defrag for long-lived resources.
    acceptance_criteria:
      - Fragmentation telemetry in runtime
      - Defrag tested without visible stalls (background)
    dependencies: [STAB-008]
    estimate: 3d
    priority: P2
    labels: [render, perf]

  - id: STAB-022
    epic: EPIC-06
    title: Tiered material fallbacks
    description: Feature probes; PBR → simple → unlit paths with visual parity tests.
    acceptance_criteria:
      - Materials render on low-tier devices with graceful downgrade
      - Golden images per tier within thresholds
    dependencies: [STAB-013, STAB-011]
    estimate: 3d
    priority: P3
    labels: [render, assets]

  - id: STAB-023
    epic: EPIC-06
    title: TAA stability improvements
    description: History/neighbor clamping; deterministic seeds; invalidation rules.
    acceptance_criteria:
      - Measurable reduction in ghosting/shimmer in test scenes
      - Deterministic results under fixed mode
    dependencies: [STAB-017]
    estimate: 3d
    priority: P3
    labels: [render]

  - id: STAB-024
    epic: EPIC-06
    title: Visibility system with hysteresis and stable sort keys
    description: Hi-Z + occlusion; hysteresis to avoid flicker; stable sort keys for submissions.
    acceptance_criteria:
      - Flicker reduced in popping scenarios
      - Stable GPU submission order under identical inputs
    dependencies: [STAB-008]
    estimate: 4d
    priority: P3
    labels: [render, perf]

  - id: STAB-025
    epic: EPIC-07
    title: Deterministic asset import and content-addressed cache
    description: Byte-for-byte deterministic bake; hashing for cache keys.
    acceptance_criteria:
      - Rebuilds reproducible across machines/toolchains
      - Cache hit/miss metrics exported
    dependencies: [STAB-013]
    estimate: 4d
    priority: P1
    labels: [assets, build]

  - id: STAB-026
    epic: EPIC-07
    title: USD authoring pipeline with layers/variants
    description: Authoring in USD with override layers, variant sets for LOD/platform.
    acceptance_criteria:
      - Example USD stage demonstrating overrides and variants
      - Docs for authoring workflow
    dependencies: [STAB-013]
    estimate: 3d
    priority: P2
    labels: [assets]

  - id: STAB-027
    epic: EPIC-07
    title: Runtime glTF packs with KTX2/meshopt
    description: Export runtime packs with compressed textures and meshopt; schema-validated metadata.
    acceptance_criteria:
      - Runtime loader reads packs; validation passes
      - Size/perf targets documented
    dependencies: [STAB-025]
    estimate: 3d
    priority: P2
    labels: [assets, render]

  - id: STAB-028
    epic: EPIC-07
    title: Importer sandboxing and fuzzing
    description: Sandbox parsers; fuzz corpus; size/complexity limits; quarantine unknown extensions.
    acceptance_criteria:
      - Fuzzer crashes triaged and minimized
      - Sandbox prevents filesystem/network escape in tests
    dependencies: [STAB-027]
    estimate: 5d
    priority: P2
    labels: [assets, security, testing]

  - id: STAB-029
    epic: EPIC-07
    title: Safe hot-reload with debounce and guard rails
    description: Debounced hot-reload; material/state hash changes trigger safe rebind.
    acceptance_criteria:
      - No device loss or leaks on repeated reload
      - State changes atomic with visible frame fences
    dependencies: [STAB-020, STAB-027]
    estimate: 3d
    priority: P3
    labels: [render, assets]

  - id: STAB-030
    epic: EPIC-08
    title: Fixed substep solver configuration
    description: Implement substeps, warm-starting, CCD; consistent units (meters) and scales.
    acceptance_criteria:
      - Stability under fast movers with CCD enabled
      - Unit tests for constraint stabilization limits
    dependencies: [STAB-012]
    estimate: 3d
    priority: P1
    labels: [physics]

  - id: STAB-031
    epic: EPIC-08
    title: Broadphase and sleeping configuration
    description: Select SAP/DBVT per scene profile; sleeping thresholds tuned.
    acceptance_criteria:
      - Benchmarks show reduced jitter and CPU under tuned config
      - Deterministic ordering in island processing
    dependencies: [STAB-030]
    estimate: 2d
    priority: P2
    labels: [physics, perf]

  - id: STAB-032
    epic: EPIC-08
    title: Deterministic physics mode
    description: Sorted island processing; disable nondeterministic features; seed all randomness.
    acceptance_criteria:
      - Record/replay produces identical results for physics-only scenes
      - CI determinism test added
    dependencies: [STAB-006, STAB-030]
    estimate: 3d
    priority: P2
    labels: [physics, testing]

  - id: STAB-033
    epic: EPIC-09
    title: Golden image regression framework
    description: Cross-GPU/vendor golden images with SSIM/LPIPS thresholds and exclusion masks.
    acceptance_criteria:
      - Baseline captures for matrix
      - CI job compares images and fails on regressions
    dependencies: [STAB-010, STAB-008]
    estimate: 4d
    priority: P1
    labels: [render, testing, ci]

  - id: STAB-034
    epic: EPIC-09
    title: Determinism tests with record/replay
    description: Input capture/replay; identical outputs under determinism mode.
    acceptance_criteria:
      - Hash of outputs identical across runs
      - Coverage includes sim, culling, draw submission order
    dependencies: [STAB-006]
    estimate: 3d
    priority: P1
    labels: [testing]

  - id: STAB-035
    epic: EPIC-09
    title: Property-based tests for math/geometry
    description: QuickCheck-style tests for transforms, quats, skinning; NaN/Inf sanitizers.
    acceptance_criteria:
      - Failures produce minimal repros
      - Sanitizers integrated in debug builds
    dependencies: [STAB-016]
    estimate: 3d
    priority: P2
    labels: [math, testing]

  - id: STAB-036
    epic: EPIC-09
    title: Sanitizers and UB checks in CI
    description: Enable UB/ASan/TSan where supported; suppressions managed.
    acceptance_criteria:
      - CI lanes green with sanitizers on supported platforms
      - Documented unsupported cases
    dependencies: []
    estimate: 2d
    priority: P2
    labels: [ci, testing]

  - id: STAB-037
    epic: EPIC-09
    title: Soak tests with leak and fragmentation tracking
    description: Hours-long runs; memory/handle leak detection; fragmentation metrics.
    acceptance_criteria:
      - Automated soak job with alerts on thresholds
      - Reports archived as build artifacts
    dependencies: [STAB-021]
    estimate: 3d
    priority: P2
    labels: [testing, perf]

  - id: STAB-038
    epic: EPIC-09
    title: Importer fuzzing corpus and minimizer
    description: Curated corpus; automatic crash minimization and repro packer.
    acceptance_criteria:
      - Crashes produce repro zips with inputs and logs
      - Corpus growth tracked over time
    dependencies: [STAB-028]
    estimate: 3d
    priority: P3
    labels: [assets, testing]

  - id: STAB-039
    epic: EPIC-10
    title: Structured logging and frame markers
    description: JSON logs with per-frame markers; GPU/CPU timing per pass; metric exports.
    acceptance_criteria:
      - Log schema versioned; parsed by tooling
      - Timers published to metrics backend
    dependencies: []
    estimate: 2d
    priority: P1
    labels: [observability]

  - id: STAB-040
    epic: EPIC-10
    title: Crash dumps and automatic triage bucketing
    description: Symbolized crash dumps; bucketing and GPU crash reports ingestion.
    acceptance_criteria:
      - Crashes auto-bucket with top signatures
      - GPU crash dumps attached where supported
    dependencies: []
    estimate: 3d
    priority: P2
    labels: [observability]

  - id: STAB-041
    epic: EPIC-10
    title: Repro recipe capture
    description: Capture scene hash, driver, caps, seeds, dt history for repro packs.
    acceptance_criteria:
      - One-click repro pack from crash/bug report
      - Privacy-reviewed contents
    dependencies: [STAB-039]
    estimate: 2d
    priority: P2
    labels: [observability]

  - id: STAB-042
    epic: EPIC-11
    title: Phase 1 façade and validation layers
    description: Wrap time, math, logging behind façade; add NaN/Inf guards.
    acceptance_criteria:
      - Existing subsystems compile against façade
      - Guards catch injected faults in tests
    dependencies: [STAB-002, STAB-016, STAB-015]
    estimate: 4d
    priority: P1
    labels: [migration]

  - id: STAB-043
    epic: EPIC-11
    title: Phase 2 loop swap and floating-origin enablement
    description: Swap to fixed-step + interpolation; enable floating-origin in test scenes.
    acceptance_criteria:
      - Dual-run scenes match visually; performance within budget
      - Toggle to fall back to legacy loop
    dependencies: [STAB-005, STAB-007]
    estimate: 4d
    priority: P1
    labels: [migration]

  - id: STAB-044
    epic: EPIC-11
    title: Phase 3 frame graph side-by-side
    description: Run frame graph alongside legacy renderer; cut over pass-by-pass.
    acceptance_criteria:
      - Selected passes switched with golden parity
      - Kill-switch to revert per pass
    dependencies: [STAB-008]
    estimate: 5d
    priority: P2
    labels: [migration, render]

  - id: STAB-045
    epic: EPIC-11
    title: Phase 4 deterministic asset pipeline
    description: USD→bake→glTF/KTX2; lock import versions; deterministic rebuilds.
    acceptance_criteria:
      - Byte-identical rebuilds across machines
      - Version locks recorded and enforced
    dependencies: [STAB-025, STAB-027]
    estimate: 4d
    priority: P2
    labels: [migration, assets]

  - id: STAB-046
    epic: EPIC-11
    title: Phase 5 physics replacement dual-sim
    description: Dual-run physics; reconcile authoring parameters; compare results.
    acceptance_criteria:
      - Key scenes within tolerance across engines
      - Switch-over plan with rollback
    dependencies: [STAB-030, STAB-032]
    estimate: 5d
    priority: P2
    labels: [migration, physics]

  - id: STAB-047
    epic: EPIC-11
    title: Phase 6 enable determinism mode and perf gates
    description: Determinism mode default in CI; golden tests active; perf gates enforced.
    acceptance_criteria:
      - CI green with determinism lanes
      - Perf regressions blocked by gates
    dependencies: [STAB-033, STAB-034, STAB-004]
    estimate: 3d
    priority: P1
    labels: [migration, ci]

  - id: STAB-048
    epic: EPIC-12
    title: Semver policy and compatibility tests
    description: Define semver for public APIs; add compatibility test suite.
    acceptance_criteria:
      - Policy doc and deprecation windows
      - CI job runs compatibility tests per release
    dependencies: []
    estimate: 2d
    priority: P2
    labels: [governance]

  - id: STAB-049
    epic: EPIC-12
    title: Third-party pinning and SBOM
    description: Pin dependencies; generate SBOM; license checks in CI; reproducible build locks.
    acceptance_criteria:
      - SBOM artifact generated per build
      - Reproducible builds via locked toolchain versions
    dependencies: []
    estimate: 3d
    priority: P2
    labels: [governance, build]

  - id: STAB-050
    epic: EPIC-12
    title: Driver/toolchain matrix with known-good sets
    description: Define and test quarterly matrix across drivers/toolchains; publish known-good list.
    acceptance_criteria:
      - Matrix doc published; failing combos quarantined
      - Quarterly refresh schedule in calendar
    dependencies: [STAB-033]
    estimate: 2d
    priority: P3
    labels: [governance, testing]

  - id: STAB-051
    epic: EPIC-13
    title: CI perf gates and dashboards
    description: Add gates for frame time, jobs, draws; dashboards for trends.
    acceptance_criteria:
      - Gates configurable per platform
      - Dashboards live with historical trends
    dependencies: [STAB-004, STAB-039]
    estimate: 3d
    priority: P1
    labels: [perf, ci]

  - id: STAB-052
    epic: EPIC-13
    title: Memory pool budgets and fragmentation alarms
    description: Budgets per pool; fragmentation thresholds; allocator telemetry.
    acceptance_criteria:
      - Runtime warnings when crossing thresholds
      - CI alerts for chronic fragmentation
    dependencies: [STAB-021]
    estimate: 2d
    priority: P2
    labels: [perf]

  - id: STAB-053
    epic: EPIC-13
    title: Job system limits and contention alarms
    description: Max jobs/queues; contention detection and alerts.
    acceptance_criteria:
      - Contention visualized in traces
      - CI test scene trips alarm under synthetic stress
    dependencies: []
    estimate: 2d
    priority: P3
    labels: [perf, engine]

  - id: STAB-054
    epic: EPIC-14
    title: Parser sandboxing and input limits
    description: Sandboxed asset parsing; timeouts; size caps; path allowlists.
    acceptance_criteria:
      - Negative tests prove isolation and limits
      - All importers comply with limits
    dependencies: [STAB-028]
    estimate: 3d
    priority: P1
    labels: [security, assets]

  - id: STAB-055
    epic: EPIC-14
    title: Signed shader blobs and IR validation
    description: No runtime shader compile in production; signatures checked; IR validation on load.
    acceptance_criteria:
      - Runtime refuses unsigned/invalid shaders
      - CI signs blobs and validates
    dependencies: [STAB-011]
    estimate: 3d
    priority: P2
    labels: [security, render]

  - id: STAB-056
    epic: EPIC-14
    title: Hardened serialization for network/state sync
    description: Versioned schemas; checksums; fuzzed deserialization paths.
    acceptance_criteria:
      - Back/forward compatibility tests
      - Fuzzer coverage for deserializers
    dependencies: []
    estimate: 3d
    priority: P2
    labels: [security, networking]

  - id: STAB-057
    epic: EPIC-15
    title: Acceptance checklist definitions and CI gates
    description: Encode acceptance checks: device-loss recovery, determinism suite, 24h soak NaN/Inf-free, golden image stability, deterministic pipeline rebuild.
    acceptance_criteria:
      - CI pipeline has an "Acceptance" stage that enforces all checks
      - Failures produce actionable links (repro packs, logs)
    dependencies: [STAB-019, STAB-034, STAB-037, STAB-033, STAB-025]
    estimate: 4d
    priority: P1
    labels: [ci, stability]
