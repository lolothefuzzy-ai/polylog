# Shader compilation pipeline: HLSL -> SPIR-V -> Cross-compile\n# STAB-011: Shader toolchain with DXC and SPIRV-Cross\n\nfind_program(DXC_EXECUTABLE dxc REQUIRED)\nfind_program(SPIRV_CROSS_EXECUTABLE spirv-cross REQUIRED)\n\n# Include hash helper\ninclude(${CMAKE_CURRENT_LIST_DIR}/include_hasher.cmake)\n\nfunction(compile_shaders TARGET_NAME SOURCE_DIR OUTPUT_DIR)\n    # Create output directory\n    file(MAKE_DIRECTORY ${OUTPUT_DIR})\n    \n    # Find all HLSL shaders\n    file(GLOB SHADER_SOURCES \"${SOURCE_DIR}/*.hlsl\")\n    \n    if(NOT SHADER_SOURCES)\n        message(WARNING \"No HLSL shaders found in ${SOURCE_DIR}\")\n        return()\n    endif()\n    \n    set(COMPILED_SHADERS \"\")\n    \n    foreach(SHADER ${SHADER_SOURCES})\n        get_filename_component(SHADER_NAME ${SHADER} NAME_WE)\n        get_filename_component(SHADER_EXT ${SHADER} EXT)\n        \n        # Compute include graph hash\n        compute_include_hash(${SHADER} INCLUDE_HASH)\n        \n        # Compile to SPIR-V\n        set(SPIRV_OUTPUT \"${OUTPUT_DIR}/${SHADER_NAME}.spv\")\n        add_custom_command(\n            OUTPUT ${SPIRV_OUTPUT}\n            COMMAND ${DXC_EXECUTABLE}\n                -T vs_6_0\n                -E main\n                ${SHADER}\n                -Fo ${SPIRV_OUTPUT}\n                -Werror\n                -HV 2021\n                -DINCLUDE_HASH=${INCLUDE_HASH}\n            DEPENDS ${SHADER}\n            COMMENT \"[DXC] Compiling ${SHADER_NAME} to SPIR-V\"\n            VERBATIM\n        )\n        \n        # Cross-compile to GLSL\n        set(GLSL_OUTPUT \"${OUTPUT_DIR}/${SHADER_NAME}.glsl\")\n        add_custom_command(\n            OUTPUT ${GLSL_OUTPUT}\n            COMMAND ${SPIRV_CROSS_EXECUTABLE}\n                --version 450\n                --output ${GLSL_OUTPUT}\n                ${SPIRV_OUTPUT}\n            DEPENDS ${SPIRV_OUTPUT}\n            COMMENT \"[SPIRV-Cross] Cross-compiling ${SHADER_NAME} to GLSL\"\n            VERBATIM\n        )\n        \n        list(APPEND COMPILED_SHADERS ${SPIRV_OUTPUT} ${GLSL_OUTPUT})\n    endforeach()\n    \n    # Create custom target\n    add_custom_target(\n        ${TARGET_NAME}_shaders ALL\n        DEPENDS ${COMPILED_SHADERS}\n    )\n    \n    # Link to main target\n    add_dependencies(${TARGET_NAME} ${TARGET_NAME}_shaders)\n    \n    message(STATUS \"[Shaders] Configured ${TARGET_NAME} with ${SHADER_SOURCES} sources\")\nendfunction()\n\n# Usage in CMakeLists.txt:\n#   compile_shaders(my_engine_target \n#                   \"${CMAKE_CURRENT_SOURCE_DIR}/shaders\"\n#                   \"${CMAKE_CURRENT_BINARY_DIR}/shaders\")\n