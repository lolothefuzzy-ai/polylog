#pragma once\n#include <cstdint>\n#include <cmath>\n#include <algorithm>\n\nnamespace polylog::engine {\n\n/**\n * Configuration for main loop timing.\n * STAB-005: Fixed-step simulation with interpolation.\n */\nstruct FrameTimingConfig {\n    /// Fixed simulation timestep in seconds (default 60 Hz)\n    float fixed_dt_s = 1.0f / 60.0f;\n    \n    /// Maximum accumulated time before catch-up (prevent spiral; default 100ms)\n    float max_accumulator_s = 0.1f;\n    \n    /// Clamp incoming frame dt to prevent huge spikes (default 50ms)\n    float max_dt_s = 0.05f;\n    \n    /// Enable fixed-step mode; if false, runs at variable dt (legacy mode)\n    bool enable_fixed_step = true;\n};\n\n/**\n * Main game loop with fixed-step simulation and interpolation.\n * \n * Usage:\n *   MainLoop loop(config);\n *   while (running) {\n *       float real_dt = GetRealDeltaTime();\n *       loop.Update(real_dt);\n *       \n *       // Simulate N times with fixed dt\n *       for (int i = 0; i < loop.GetSimStepsThisFrame(); ++i) {\n *           SimulateOneStep(loop.GetFixedDt());\n *       }\n *       \n *       // Render with interpolation\n *       float alpha = loop.GetInterpolationAlpha();\n *       RenderFrame(alpha);\n *   }\n */\nclass MainLoop {\npublic:\n    explicit MainLoop(const FrameTimingConfig& config = FrameTimingConfig());\n    \n    /**\n     * Update accumulator with incoming real delta time.\n     * Call once per frame from the main loop.\n     */\n    void Update(float real_dt_s);\n    \n    /// Interpolation factor [0, 1) for rendering between sim frames.\n    float GetInterpolationAlpha() const { return interpolation_alpha_; }\n    \n    /// Total simulation time elapsed (in fixed steps).\n    float GetSimTime() const { return sim_time_s_; }\n    \n    /// Number of simulation steps to run this frame (0, 1, or 2+).\n    int GetSimStepsThisFrame() const { return sim_steps_this_frame_; }\n    \n    /// Fixed timestep used (read from config)\n    float GetFixedDt() const { return config_.fixed_dt_s; }\n    \n    /// Current accumulator time (for diagnostics)\n    float GetAccumulator() const { return accumulator_s_; }\n    \nprivate:\n    FrameTimingConfig config_;\n    float accumulator_s_ = 0.0f;      // Accumulated time waiting for simulation\n    float sim_time_s_ = 0.0f;         // Total simulation time\n    float interpolation_alpha_ = 0.0f;  // Render interpolation [0, 1)\n    int sim_steps_this_frame_ = 0;    // Simulation steps to run\n    \n    /// Clamp incoming delta time and accumulator.\n    void ClampDeltaTime(float& dt);\n};\n\n}  // namespace polylog::engine\n