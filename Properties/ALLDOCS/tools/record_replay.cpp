#include "record_replay.h\"\n#include <fstream>\n#include <sstream>\n#include <cstring>\n\nnamespace polylog::tools {\n\nvoid InputRecorder::Record(const InputEvent& event) {\n    events_.push_back(event);\n}\n\nvoid InputRecorder::SaveToFile(const std::string& path) {\n    std::ofstream file(path, std::ios::binary);\n    if (!file.is_open()) return;\n    \n    // Write header\n    uint32_t event_count = events_.size();\n    file.write(reinterpret_cast<const char*>(&event_count), sizeof(event_count));\n    \n    // Write events\n    for (const auto& event : events_) {\n        file.write(reinterpret_cast<const char*>(&event.type), sizeof(event.type));\n        file.write(reinterpret_cast<const char*>(&event.key_or_axis), sizeof(event.key_or_axis));\n        file.write(reinterpret_cast<const char*>(&event.value_x), sizeof(event.value_x));\n        file.write(reinterpret_cast<const char*>(&event.value_y), sizeof(event.value_y));\n        file.write(reinterpret_cast<const char*>(&event.frame_num), sizeof(event.frame_num));\n    }\n}\n\nbool InputReplayer::LoadFromFile(const std::string& path) {\n    std::ifstream file(path, std::ios::binary);\n    if (!file.is_open()) return false;\n    \n    // Read header\n    uint32_t event_count = 0;\n    file.read(reinterpret_cast<char*>(&event_count), sizeof(event_count));\n    \n    events_.clear();\n    for (uint32_t i = 0; i < event_count; ++i) {\n        InputEvent event;\n        file.read(reinterpret_cast<char*>(&event.type), sizeof(event.type));\n        file.read(reinterpret_cast<char*>(&event.key_or_axis), sizeof(event.key_or_axis));\n        file.read(reinterpret_cast<char*>(&event.value_x), sizeof(event.value_x));\n        file.read(reinterpret_cast<char*>(&event.value_y), sizeof(event.value_y));\n        file.read(reinterpret_cast<char*>(&event.frame_num), sizeof(event.frame_num));\n        events_.push_back(event);\n    }\n    \n    playback_index_ = 0;\n    return file.good();\n}\n\nInputEvent* InputReplayer::GetNextEvent(uint32_t frame_num) {\n    if (playback_index_ >= events_.size()) {\n        return nullptr;\n    }\n    \n    if (events_[playback_index_].frame_num == frame_num) {\n        return &events_[playback_index_++];\n    }\n    \n    return nullptr;\n}\n\n}  // namespace polylog::tools\n